<!--

color picker - ColorJoe:
https://github.com/bebraw/colorjoe/
http://bebraw.github.io/colorjoe/
https://blog.logrocket.com/color-picker-libraries-to-use-in-2021/

-->

<!DOCTYPE html>
<html>

<head>

<title>ColorJumper WIP</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/colorjoe@4.1.1/css/colorjoe.css"/>
<!--<script src="https://cdn.jsdelivr.net/npm/colorjoe@4.1.1/dist/colorjoe.js"></script>-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ahetric/ahetric.github.io/colorJumper/colorjoe.js"></script>


<style type="text/css">

:root {
    --colorjoe-height: 450px;
    --color-block-height: 150px;
}
    
body {
    width: 80%;
    height: 80%;
    margin: auto;
}

#main {
    height: 550px;
}

#titles {
    position: relative;
    top: 0;
    text-transform: uppercase;
    font-family: arial;
    text-align: center;
}

#pickerContainer {
    float:left;
    background:#efefef;
}

#resultContainer {
    float:left;
    background:#efefef;
    height: calc(var(--colorjoe-height) + 42px);
}

#resultInnerContainer {
    margin: 10px;
    background: white;
}

#resultBlock {
    width: var(--color-block-height);
    height: var(--color-block-height);
    background: purple;
    position: relative;
    margin: 8px;
    top: 8px;
}

#boundsAlert {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    position: absolute;
    top: -10px;
    right: -10px;
    border: 1px solid white;
    text-align: center;
    background: black;
    color: white;
}
      
/* begin overriding ColorJoe properties */

.colorPicker {
    //background: inherit;
    background: #fff;
    border: 0px;
    -moz-border-radius: 0em;
    border-radius: 0em;
    margin: 10px;

    position: relative;
    height: var(--colorjoe-height);
}

.colorPicker .extras {
    margin:inherit;
    margin-left: 8px;
    position: absolute;
    bottom: 0;
}

.colorPicker .extras .currentColor {
    width: var(--color-block-height);
    height: var(--color-block-height);
    border: 0px;
    -moz-border-radius: 0em;
    border-radius: 0em;

    position: absolute;
    bottom: calc(var(--colorjoe-height) - var(--color-block-height) - 18px);
}

.colorPicker .extras .colorFields {
    position: absolute;
    bottom: 0;
    right: calc(-1 * var(--color-block-height));
    text-transform: uppercase;
}

.colorPicker .extras .hex {
    position: absolute;
    bottom: 0;
}

.colorPicker .twod, .colorPicker .oned {
    margin-top: calc(var(--color-block-height) + 18px);
}

.colorPicker .twod, .colorPicker .twod .bg {
    width: var(--color-block-height);
    height: var(--color-block-height);
}

.colorPicker .oned, .colorPicker .oned .bg {
    height: var(--color-block-height);
}

.colorPicker .oned, .colorPicker .oned .bg {
    height: 20px;
    width: 150px;
    
    position: absolute;
    margin-top: calc(var(--color-block-height) + 13px);
}

.colorPicker .oned .bg {
    border: 0px;
}

.colorPicker .oned .pointer .shape {
    position: absolute;
    margin-left: -4px;
    margin-top: 3px;
    height: 20px;
    width:5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    
    margin-top: calc(var(--color-block-height) + 11px);
}

.colorPicker .oned .bg {
    background: -moz-linear-gradient(left,  #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 66%, #ff00ff 83%, #ff0000 100%);
    background: -webkit-gradient(linear, left, right, color-stop(0%,#ff0000), color-stop(17%,#ffff00), color-stop(33%,#00ff00), color-stop(50%,#00ffff), color-stop(66%,#0000ff), color-stop(83%,#ff00ff), color-stop(100%,#ff0000));
    background: -webkit-linear-gradient(left,  #ff0000 0%,#ffff00 17%,#00ff00 33%,#00ffff 50%,#0000ff 66%,#ff00ff 83%,#ff0000 100%);
    background: -o-linear-gradient(left,  #ff0000 0%,#ffff00 17%,#00ff00 33%,#00ffff 50%,#0000ff 66%,#ff00ff 83%,#ff0000 100%);
    background: linear-gradient(to right,  #ff0000 0%,#ffff00 17%,#00ff00 33%,#00ffff 50%,#0000ff 66%,#ff00ff 83%,#ff0000 100%);
}

/* end overriding ColorJoe properties */

</style>
</head>

<body>

    <div id="main">
        <h1>ColorJumper WIP</h1>
        <div id="pickerContainer">
            <div id="titles">Initial</div>
            <div id="initialPicker"></div>
        </div>
        <div id="pickerContainer">
            <div id="titles">Midpoint</div>
            <div id="midpointPicker"></div>
        </div>
        <div id="resultContainer">
            <div id="titles">Result</div>
            <div id="resultInnerContainer">
                <div id="resultBlock">
                    <div id="boundsAlert">!</div>
                </div>
                <p id="resultText" style="margin-left:8px;"></p>
            </div>
        </div>
    </div>
    

    <script type="text/javascript">
        $(document).ready(function () {
            
            /*var initial = {
                r: 0x75,
                g: 0x42,
                b: 0x42
            }*/
            
            var initial = {
                r: 0x45,
                g: 0x37,
                b: 0x37
            }
            
            var midpoint = {
                r: 0xaa,
                g: 0x61,
                b: 0x61
            }
            
            var result = {
                r: -1,
                g: -1,
                b: -1
            }
            
            var inBounds = {
                r: true,
                g: true,
                b: true
            }
            
            
            const initialColorPicker = 
            colorjoe.rgb("initialPicker", obj_to_RGB(initial), [
                "currentColor",
                "hex",
                ["fields", { space: "RGB", limit: 255, fix: 0 }]
        ]);
        
            initialColorPicker.on("change", function (c) {
                
                RGB_to_obj(c.css(), initial);
                calculate();
                
            }).update();
            
            
            const midpointColorPicker = 
            colorjoe.rgb("midpointPicker", obj_to_RGB(midpoint), [
                "currentColor",
                "hex",
                ["fields", { space: "RGB", limit: 255, fix: 0 }]
        ]);
        
            midpointColorPicker.on("change", function (c) {
                
                RGB_to_obj(c.css(), midpoint);
                calculate();
                
            }).update();
            
            
            
            
            /* colorJumper functions */
            
            
            /* RGB_to_obj(rgb, color)
             *
             * params:
             * rgb: a String
             * color: the object with RGB fields to be updated
             *
             * converts String "rgb(z,y,z)" to
             * object properties {r: x, g: y, b: z}
             */
            function RGB_to_obj(rgb, color) {
                var splitString = rgb.split(",");
                color.r = parseInt(splitString[0].slice(4));
                color.g = parseInt(splitString[1]);
                color.b = parseInt(splitString[2].slice(0, -1));
            }
            
            function obj_to_RGB(color) {
                return "rgb("+color.r+","
                             +color.g+","
                             +color.b+")";
            }
            
            function obj_to_hex(color) {
                return "#"+color.r.toString(16)
                          +color.g.toString(16)
                          +color.b.toString(16);
            }
            
            function showBoundsAlert() {
                /*if (inBounds.r && inBounds.g && inBounds.b) {
                    document.getElementById('boundsAlertRed').style.display = 'none'; 
                } else {
                    document.getElementById('boundsAlertRed').style.display = 'block'; 
                }*/
                
                $("#boundsAlert").css("display", "none");
                
                if (!inBounds.r) {
                    $("#boundsAlert").css("display", "block");
                    $("#boundsAlert").css("background", "#FF3300");
                    if (!inBounds.g) {
                        $("#boundsAlert").css("background", "#808000");
                        if (!inBounds.b) {
                            $("#boundsAlert").css("background", "#808080");
                        }
                    }
                    else if (!inBounds.b) {
                        $("#boundsAlert").css("background", "#803380");
                    }
                }
                else if (!inBounds.g) {
                    $("#boundsAlert").css("display", "block");
                    $("#boundsAlert").css("background", "#00CC00");
                    if (!inBounds.b) {
                        $("#boundsAlert").css("background", "#008080");
                    }
                }
                else if (!inBounds.b) {
                    $("#boundsAlert").css("display", "block");
                    $("#boundsAlert").css("background", "#0033FF");
                }
                
            }
            
            
            /*
             * Calculates new result color.
             */
            function calculate() {
                
                [result.r, inBounds.r] = calculateRGB(initial.r, midpoint.r);
                [result.g, inBounds.g] = calculateRGB(initial.g, midpoint.g);
                [result.b, inBounds.b] = calculateRGB(initial.b, midpoint.b);
                showBoundsAlert();
                
                
                $("#resultBlock").css("background", obj_to_RGB(result));
                document.getElementById("resultText").innerHTML = obj_to_RGB(result) + "<br>" + obj_to_hex(result) + "<br>" + inBounds.r + " " + inBounds.g + " " + inBounds.b;
                
                
                inBounds.r = true;
                inBounds.g = true;
                inBounds.b = true;
            }
            
            function calculateRGB(initialRGB, midpointRGB) {
                
                var resultRGB = 0;
                var inBoundsRGB = true;
                var temp = Math.abs(midpointRGB-initialRGB);
                
               if (midpointRGB >= initialRGB) {
                  temp = Math.abs(temp+midpointRGB);
                  resultRGB = Math.min(temp, 0xFF);
               }
               else {
                   temp = Math.abs(temp-midpointRGB);
                   resultRGB = Math.max(temp, 0x00);
               }
               
                  
               if (temp > 0xFF || temp < 0x00) {
                  inBoundsRGB = false;
               }
               return [resultRGB, inBoundsRGB];
            }
            
            
            
            
            
            
        });
        
    </script>
    
</body>

</html>